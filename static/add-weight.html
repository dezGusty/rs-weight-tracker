<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Add Weight</title>
  </head>
  <body>
    <a href="index.html">Main</a>
    <form>
      <label for="weight">Weight:</label>
      <input type="number" id="weight" name="weight"><br>

      <label for="measurement-date">Measurement Date:</label>
      <input type="date" id="measurement-date" name="measurement-date"><br>

      <button type="submit" id="submit">Submit</button>
    </form>

    <script>
      const form = document.querySelector('form');
      console.debug('window.location', window.location);
      let subpaths = window.location.pathname.split('/');
      let subpath = '';
      if (subpaths && subpaths.length > 0) {
        subpath = subpath + subpaths[0];
        if (subpaths[0] == '' && subpaths.length > 1) {
          subpath = subpath + '/' + subpaths[1];
        }
      }

      let baseUrl = window.location.origin + subpath;

      form.addEventListener('submit', (event) => {
        event.preventDefault();

        const weight = document.getElementById('weight').value;
        const measurementDate = document.getElementById('measurement-date').value;

        const data = {
          weight_value: parseFloat(weight),
          measurement_date: measurementDate
        };

        fetch(`${baseUrl}/api/add_weight`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          console.log(data);
          alert('Weight added successfully');
        })
        .catch(error => {
          console.error(error);
          alert('Failed to add weight');
        });
      });
    </script>
  </body>
</html>
